<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fort Worth Property Scout - Enhanced</title>
    <style>
        :root { --primary:#1E3A5F; --secondary:#2E7D32; --accent:#FF6B35; --success:#4CAF50; --danger:#F44336; --bg:#0D1117; --card-bg:#161B22; --text:#E6EDF3; --text2:#8B949E; --border:#30363D; --hover:#21262D; }
        * { margin:0; padding:0; box-sizing:border-box; }
        body { font-family:system-ui,sans-serif; background:var(--bg); color:var(--text); min-height:100vh; }
        
        .header { background:linear-gradient(135deg,var(--primary),var(--bg)); padding:1.5rem 2rem; border-bottom:1px solid var(--border); }
        .header-top { display:flex; justify-content:space-between; align-items:center; }
        .logo-section { display:flex; align-items:center; gap:1rem; }
        .logo { width:48px;height:48px;background:var(--secondary);border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:24px; }
        .title h1 { font-size:1.5rem;background:linear-gradient(90deg,var(--text),var(--secondary));-webkit-background-clip:text;-webkit-text-fill-color:transparent; }
        .title p { color:var(--text2);font-size:0.875rem; }
        
        .url-analyzer { background:var(--card-bg);border:1px solid var(--border);border-radius:12px;padding:1rem;margin-top:1rem; }
        .url-analyzer h3 { font-size:0.9rem;margin-bottom:0.75rem; }
        .url-form { display:flex;gap:0.5rem;flex-wrap:wrap; }
        .url-input { flex:1;min-width:200px;padding:0.75rem;border:1px solid var(--border);border-radius:8px;background:var(--bg);color:var(--text);font-size:0.9rem; }
        .analyze-btn { background:var(--secondary);border:none;color:#fff;padding:0.75rem 1.5rem;border-radius:8px;cursor:pointer;font-weight:500; }
        .analyze-btn:hover { background:#3d9d42; }
        .analyze-btn:disabled { opacity:0.5; }
        .analyze-status { margin-top:0.75rem;font-size:0.8rem; }
        
        .manual-add { margin-top:1rem;padding-top:1rem;border-top:1px solid var(--border); }
        .manual-toggle { background:none;border:none;color:var(--text2);cursor:pointer;font-size:0.8rem; }
        .manual-form { display:none;grid-template-columns:repeat(auto-fit,minmax(100px,1fr));gap:0.5rem;margin-top:0.5rem; }
        .manual-form.show { display:grid; }
        .manual-input { padding:0.5rem;border:1px solid var(--border);border-radius:6px;background:var(--bg);color:var(--text);font-size:0.8rem; }
        
        .nav { display:flex;gap:0.5rem;padding:1rem 2rem;background:var(--card-bg);border-bottom:1px solid var(--border); }
        .nav button { background:transparent;border:none;color:var(--text2);padding:0.75rem 1.5rem;border-radius:8px;cursor:pointer;font-weight:500; }
        .nav button.active { background:var(--secondary);color:#fff; }
        
        .main { padding:1.5rem 2rem;max-width:1600px;margin:0 auto; }
        
        .kpi-grid { display:grid;grid-template-columns:repeat(4,1fr);gap:1rem;margin-bottom:1.5rem; }
        @media(max-width:1200px){.kpi-grid{grid-template-columns:repeat(2,1fr)}}
        .kpi-card { background:var(--card-bg);border:1px solid var(--border);border-radius:12px;padding:1.25rem;position:relative; }
        .kpi-card:hover .kpi-details { display:block; }
        .kpi-details { display:none;position:absolute;top:100%;left:-1px;right:-1px;background:var(--card-bg);border:1px solid var(--secondary);border-radius:0 0 12px 12px;padding:1rem;z-index:100; }
        .kpi-details h4 { color:var(--secondary);font-size:0.7rem;text-transform:uppercase; }
        .kpi-details p { font-size:0.8rem;margin:0.3rem 0; }
        .kpi-value { font-size:2rem;font-weight:700; }
        .kpi-value.success{color:var(--success)}.kpi-value.danger{color:var(--danger)}.kpi-value.accent{color:var(--accent)}
        
        .charts-grid { display:grid;grid-template-columns:repeat(2,1fr);gap:1.5rem;margin-bottom:1.5rem; }
        @media(max-width:900px){.charts-grid{grid-template-columns:1fr}}
        .chart-card { background:var(--card-bg);border:1px solid var(--border);border-radius:12px;padding:1.25rem; }
        .chart-title { font-size:1rem;font-weight:600;margin-bottom:1rem; }
        .bar-chart { display:flex;flex-direction:column;gap:0.5rem; }
        .bar-row { display:flex;align-items:center;gap:0.5rem; }
        .bar-label { width:110px;font-size:0.75rem;color:var(--text2); }
        .bar-container { flex:1;height:35px;background:var(--hover);border-radius:6px;overflow:hidden;cursor:pointer; }
        .bar-fill { height:100%;background:var(--secondary);display:flex;align-items:center;padding-left:0.5rem;font-size:0.75rem;color:#fff; }
        .bar-count { width:40px;text-align:right;font-size:0.75rem;color:var(--text2); }
        
        .table-card { background:var(--card-bg);border:1px solid var(--border);border-radius:12px;overflow:hidden; }
        .table-header { padding:1rem 1.25rem;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:1rem; }
        .table-filters { display:flex;gap:0.5rem; }
        .filter-btn { background:var(--hover);border:1px solid var(--border);color:var(--text2);padding:0.5rem 1rem;border-radius:6px;font-size:0.8rem;cursor:pointer; }
        .filter-btn.active { background:var(--secondary);color:#fff; }
        table { width:100%;border-collapse:collapse; }
        th { text-align:left;padding:0.75rem;background:var(--hover);color:var(--text2);font-size:0.75rem;text-transform:uppercase;cursor:pointer; }
        td { padding:0.75rem;border-bottom:1px solid var(--border); }
        tr:hover td { background:var(--hover);cursor:pointer; }
        .status-badge { padding:0.25rem 0.75rem;border-radius:20px;font-size:0.75rem; }
        .status-badge.pass{background:rgba(76,175,80,0.2);color:var(--success)}
        .status-badge.fail{background:rgba(244,67,54,0.2);color:var(--danger)}
        
        .modal-overlay { display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.8);z-index:1000;align-items:center;justify-content:center;padding:1rem; }
        .modal-overlay.active { display:flex; }
        .modal { background:var(--card-bg);border:2px solid var(--border);border-radius:16px;width:100%;max-width:700px;max-height:90vh;overflow-y:auto; }
        .modal-header { padding:1.5rem;border-bottom:1px solid var(--border);display:flex;justify-content:space-between; }
        .modal-title { font-size:1.25rem;font-weight:600; }
        .modal-close { background:none;border:none;color:var(--text2);font-size:1.5rem;cursor:pointer; }
        .modal-body { padding:1.5rem; }
        .detail-grid { display:grid;grid-template-columns:repeat(2,1fr);gap:1rem;margin-bottom:1rem; }
        .detail-card { background:var(--hover);border-radius:8px;padding:1rem; }
        .detail-label { font-size:0.7rem;color:var(--text2);text-transform:uppercase; }
        .detail-value { font-size:1.25rem;font-weight:600; }
        .detail-value.success{color:var(--success)}.detail-value.danger{color:var(--danger)}
        .analysis-section { background:var(--hover);border-radius:8px;padding:1rem;margin-bottom:1rem; }
        .analysis-section h4 { font-size:0.875rem;margin-bottom:0.75rem;color:var(--text2); }
        .analysis-row { display:flex;justify-content:space-between;padding:0.5rem 0;border-bottom:1px solid var(--border); }
        .analysis-row:last-child { border:none; }
        .analysis-label { color:var(--text2); }
        
        .footer { text-align:center;padding:2rem;color:var(--text2);font-size:0.75rem;border-top:1px solid var(--border);margin-top:2rem; }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-top">
            <div class="logo-section">
                <div class="logo">üè†</div>
                <div class="title">
                    <h1>Fort Worth Property Scout</h1>
                    <p>Real Estate Investment Analyzer</p>
                </div>
            </div>
        </div>
        
        <div class="url-analyzer">
            <h3>üîç <strong>Add Property from URL</strong></h3>
            <form class="url-form" onsubmit="analyzeURL(event)">
                <input type="url" id="propertyUrl" class="url-input" placeholder="Paste property URL..." required>
                <button type="submit" class="analyze-btn" id="analyzeBtn">Analyze</button>
                <button type="button" class="analyze-btn" style="background:var(--accent)" onclick="askMango()">Ask Mango ü§†</button>
            </form>
            <div class="analyze-status" id="analyzeStatus">Paste a URL from Fort Worth Focused or Zillow, or click "Ask Mango" for help</div>
            
            <div class="manual-add">
                <button class="manual-toggle" onclick="document.getElementById('manualForm').classList.toggle('show')">
                    üìù Or add manually
                </button>
                <div class="manual-form" id="manualForm">
                    <input type="text" class="manual-input" id="mAddress" placeholder="Address">
                    <input type="number" class="manual-input" id="mPrice" placeholder="Price $">
                    <input type="number" class="manual-input" id="mBeds" placeholder="Beds">
                    <input type="number" class="manual-input" id="mBaths" placeholder="Baths">
                    <input type="number" class="manual-input" id="mRent" placeholder="Rent $">
                    <button type="button" class="analyze-btn" onclick="addManualProperty()">Add</button>
                </div>
            </div>
        </div>
    </header>
    
    <nav class="nav">
        <button class="active">üìä Overview</button>
        <button>üè† Properties</button>
        <button>üí∞ Analysis</button>
    </nav>
    
    <main class="main">
        <div class="kpi-grid">
            <div class="kpi-card">
                <div class="kpi-label">üìä Total</div>
                <div class="kpi-value" id="kpi-total">0</div>
                <div class="kpi-details"><h4>Breakdown</h4><p id="kpi-breakdown"></p></div>
            </div>
            <div class="kpi-card">
                <div class="kpi-label">üíµ Under $250K</div>
                <div class="kpi-value accent" id="kpi-under">0</div>
            </div>
            <div class="kpi-card">
                <div class="kpi-label">‚úÖ Passing</div>
                <div class="kpi-value success" id="kpi-pass">0</div>
            </div>
            <div class="kpi-card">
                <div class="kpi-label">üìà Avg CF</div>
                <div class="kpi-value danger" id="kpi-cf">0</div>
            </div>
        </div>
        
        <div class="charts-grid">
            <div class="chart-card"><div class="chart-title">Price Distribution</div><div id="priceChart"></div></div>
            <div class="chart-card"><div class="chart-title">Pass/Fail</div><div id="passChart"></div></div>
            <div class="chart-card"><div class="chart-title">Cash Flow by Type</div><div id="cfChart"></div></div>
            <div class="chart-card"><div class="chart-title">Properties</div><div id="pvChart"></div></div>
        </div>
        
        <div class="table-card">
            <div class="table-header">
                <div><strong>Properties</strong> (click row for details)</div>
                <div class="table-filters">
                    <button class="filter-btn active" onclick="filter('all',this)">All</button>
                    <button class="filter-btn" onclick="filter('pass',this)">Pass</button>
                    <button class="filter-btn" onclick="filter('fail',this)">Fail</button>
                    <button class="filter-btn" onclick="filter('SFR',this)">SFR</button>
                </div>
            </div>
            <table><thead><tr><th>Address</th><th>Type</th><th>Price</th><th>Beds</th><th>Rent</th><th>CF</th><th>CoC</th><th></th></tr></thead><tbody id="tableBody"></tbody></table>
        </div>
    </main>
    
    <footer class="footer">Fort Worth Property Scout | Updated: Feb 25, 2026</footer>
    
    <!-- Modal -->
    <div class="modal-overlay" id="modal">
        <div class="modal">
            <div class="modal-header">
                <div><div class="modal-title" id="mAddr"></div><div class="modal-subtitle" id="mArea"></div></div>
                <button class="modal-close" onclick="closeModal()">√ó</button>
            </div>
            <div class="modal-body">
                <div class="detail-grid">
                    <div class="detail-card"><div class="detail-label">Price</div><div class="detail-value" id="mPrice"></div></div>
                    <div class="detail-card"><div class="detail-label">Rent</div><div class="detail-value" id="mRent"></div></div>
                    <div class="detail-card"><div class="detail-label">Beds/Baths</div><div class="detail-value" id="mBeds"></div></div>
                    <div class="detail-card"><div class="detail-label">Type</div><div class="detail-value" id="mType"></div></div>
                </div>
                <div class="analysis-section">
                    <h4>üí∞ Investment Analysis</h4>
                    <div class="analysis-row"><span>Mortgage</span><span id="mMortgage"></span></div>
                    <div class="analysis-row"><span>OpEx (50%)</span><span id="mOpEx"></span></div>
                    <div class="analysis-row"><span>Tax</span><span id="mTax"></span></div>
                </div>
                <div class="analysis-section">
                    <h4>üìä Returns</h4>
                    <div class="analysis-row"><span>Cash Flow</span><span id="mCF"></span></div>
                    <div class="analysis-row"><span>CoC</span><span id="mCoC"></span></div>
                    <div class="analysis-row"><span>Cap Rate</span><span id="mCap"></span></div>
                </div>
                <div id="mVerdict" style="padding:1rem;border-radius:8px;text-align:center;font-weight:600;"></div>
            </div>
        </div>
    </div>

    <script>
        // Starting properties
        let properties = [
            {address:"2264 Lipscomb St, Fort Worth",price:730000,beds:3,baths:3,sqft:3088,type:"SFR",rent:4000,area:"Fairmount"},
            {address:"2505 Shady Ridge Dr, Bedford",price:179000,beds:1,baths:1,sqft:768,type:"Condo",rent:1200,area:"Bedford"},
            {address:"5521 Lubbock Ave, Fort Worth",price:250000,beds:3,baths:2,sqft:1295,type:"SFR",rent:1500,area:"Wedgwood"},
            {address:"4516 Rutland Ave, Fort Worth",price:215000,beds:2,baths:1,sqft:1080,type:"SFR",rent:1200,area:"Wedgwood"},
            {address:"2847 W Seminary Dr, Fort Worth",price:285000,beds:4,baths:2,sqft:2400,type:"Duplex",rent:2800,area:"South Worth"},
            {address:"7652 Colorado Creek, Fort Worth",price:212000,beds:4,baths:2,sqft:2400,type:"Duplex",rent:2602,area:"Wedgwood"},
            {address:"8812 Texas Risinger, Fort Worth",price:203000,beds:3,baths:2,sqft:1800,type:"SFR",rent:2400,area:"South Worth"},
            {address:"5113 Bob Dr, Fort Worth",price:170000,beds:2,baths:1,sqft:950,type:"SFR",rent:1407,area:"Meadowbrook"},
            {address:"9201 Apache, Fort Worth",price:195000,beds:3,baths:2,sqft:1400,type:"SFR",rent:1600,area:"Wedgwood"},
            {address:"3456 Parker Rd, Crowley",price:245000,beds:3,baths:2,sqft:1600,type:"SFR",rent:1700,area:"Crowley"}
        ];

        const DOWN=100000,RATE=0.0525,TAX=0.019;
        
        function calc(p) {
            const loan=p.price>DOWN?p.price-DOWN:0;
            const m=RATE/12,n=360;
            p.loan=loan;p.mortgage=loan>0?loan*m*Math.pow(1+m,n)/(Math.pow(1+m,n)-1):0;
            p.opEx=p.rent*0.1;p.tax=p.price*TAX/12;
            p.cf=p.rent-p.opEx-p.tax-p.mortgage;p.coc=p.cf*12/DOWN*100;
            p.cap=((p.rent-p.opEx-p.tax)*12/p.price)*100;
            p.passes=p.cf>=200&&p.coc>=8;
            return p;
        }
        
        properties.forEach(p => calc(p));
        
        let currentFilter='all',sortCol=-1;
        
        function update(){
            const total=properties.length,under=properties.filter(p=>p.price<=250000).length;
            const pass=properties.filter(p=>p.passes).length;
            const avg=properties.reduce((s,p)=>s+p.cf,0)/total;
            document.getElementById('kpi-total').textContent=total;
            document.getElementById('kpi-under').textContent=under;
            document.getElementById('kpi-pass').textContent=pass;
            document.getElementById('kpi-cf').textContent='$'+Math.round(avg);
            document.getElementById('kpi-cf').className='kpi-value '+(avg>=0?'success':'danger');
            document.getElementById('kpi-breakdown').textContent='SFR:'+properties.filter(p=>p.type==='SFR').length+' Dup:'+properties.filter(p=>p.type==='Duplex').length;
            renderCharts();renderTable();
        }
        
        function renderCharts(){
            const ranges=['<$150K','$150K-$200K','$200K-$250K','$250K-$300K','>$300K'],c=[0,0,0,0,0];
            properties.forEach(p=>{if(p.price<150000)c[0]++;else if(p.price<200000)c[1]++;else if(p.price<250000)c[2]++;else if(p.price<300000)c[3]++;else c[4]++;});
            document.getElementById('priceChart').innerHTML=ranges.map((r,i)=>`<div class="bar-row"><div class="bar-label">${r}</div><div class="bar-container"><div class="bar-fill" style="width:${c[i]?c[i]/Math.max(...c)*100:0}%">${c[i]}</div></div></div>`).join('');
            const pc=properties.filter(p=>p.passes).length;
            document.getElementById('passChart').innerHTML=['Pass('+pc+')','Fail('+(properties.length-pc)+')'].map((l,i)=>`<div class="bar-row"><div class="bar-label">${l}</div><div class="bar-container"><div class="bar-fill" style="width:${(i===0?pc:properties.length-pc)/properties.length*100}%;background:${i===0?'var(--secondary)':'var(--danger)'}">${i===0?pc:properties.length-pc}</div></div></div>`).join('');
            ['SFR','Duplex'].forEach(t=>{const ps=properties.filter(p=>p.type===t),avg=ps.length?ps.reduce((s,p)=>s+p.cf,0)/ps.length:0;document.getElementById('cfChart').innerHTML+=`<div class="bar-row"><div class="bar-label">${t}</div><div class="bar-container"><div class="bar-fill" style="width:${Math.abs(avg)/800*100}%;background:${avg>=0?'var(--secondary)':'var(--danger)'}">$${Math.round(avg)}</div></div></div>`;});
            document.getElementById('pvChart').innerHTML=properties.map(p=>`<div class="bar-row" onclick="openM(${properties.indexOf(p)})"><div class="bar-label" style="width:150px;overflow:hidden;text-overflow:ellipsis">${p.address.split(',')[0]}</div><div class="bar-container"><div class="bar-fill" style="width:${p.price/400000*100}%;background:${p.passes?'var(--secondary)':'var(--danger)'}">$${Math.round(p.cf)}</div></div></div>`).join('');
        }
        
        function renderTable(){
            let ps=[...properties];
            if(currentFilter==='pass')ps=ps.filter(p=>p.passes);
            else if(currentFilter==='fail')ps=ps.filter(p=>!p.passes);
            else if(currentFilter==='SFR')ps=ps.filter(p=>p.type==='SFR');
            document.getElementById('tableBody').innerHTML=ps.map(p=>`<tr onclick="openM(${properties.indexOf(p)})"><td>${p.address.split(',')[0]}<div style="font-size:0.7rem;color:var(--text2)">${p.area}</div></td><td>${p.type}</td><td>$${p.price.toLocaleString()}</td><td>${p.beds}</td><td>$${p.rent}</td><td style="color:${p.cf>=0?'var(--success)':'var(--danger)'}">$${Math.round(p.cf)}</td><td>${p.coc.toFixed(1)}%</td><td><span class="status-badge ${p.passes?'pass':'fail'}">${p.passes?'PASS':'FAIL'}</span></td></tr>`).join('');
        }
        
        function filter(f,btn){currentFilter=f;document.querySelectorAll('.filter-btn').forEach(b=>b.classList.remove('active'));if(btn)btn.classList.add('active');renderTable();}
        
        function openM(i){
            const p=properties[i];
            document.getElementById('mAddr').textContent=p.address.split(',')[0];
            document.getElementById('mArea').textContent=p.area;
            document.getElementById('mPrice').textContent='$'+p.price.toLocaleString();
            document.getElementById('mRent').textContent='$'+p.rent;
            document.getElementById('mBeds').textContent=p.beds+'/'+p.baths;
            document.getElementById('mType').textContent=p.type;
            document.getElementById('mMortgage').textContent='$'+Math.round(p.mortgage);
            document.getElementById('mOpEx').textContent='$'+Math.round(p.opEx);
            document.getElementById('mTax').textContent='$'+Math.round(p.tax);
            const cf=document.getElementById('mCF'),vd=document.getElementById('mVerdict');
            cf.textContent='$'+Math.round(p.cf);cf.style.color=p.cf>=0?'var(--success)':'var(--danger)';
            document.getElementById('mCoC').textContent=p.coc.toFixed(1)+'%';
            document.getElementById('mCap').textContent=p.cap.toFixed(1)+'%';
            vd.innerHTML=p.passes?'‚úÖ PASS':'‚ùå FAIL - Need $'+Math.round(200-p.cf)+' more';
            vd.style.background=p.passes?'rgba(76,175,80,0.2)':'rgba(244,67,54,0.2)';
            vd.style.color=p.passes?'var(--success)':'var(--danger)';
            document.getElementById('modal').classList.add('active');
        }
        function closeModal(){document.getElementById('modal').classList.remove('active');}
        
        // URL Analyzer - tries to extract data from listing URLs
        async function analyzeURL(e){
            e.preventDefault();
            const url = document.getElementById('propertyUrl').value;
            const btn = document.getElementById('analyzeBtn');
            const status = document.getElementById('analyzeStatus');
            
            if(!url){
                status.innerHTML = '‚ö†Ô∏è Paste a URL first';
                return;
            }
            
            btn.disabled = true;
            status.innerHTML = 'üîÑ Fetching property data...';
            
            try{
                // Call Mango's scraping API
                const apiUrl = 'https://perfect-falcon-40.loca.lt/api/scrape?url=' + encodeURIComponent(url);
                const response = await fetch(apiUrl);
                const data = await response.json();
                
                if(data.found || data.price || data.address){
                    // Pre-fill form
                    if(data.address) document.getElementById('mAddress').value = data.address.replace(' - MLS#.*', '');
                    if(data.price) document.getElementById('mPrice').value = data.price;
                    if(data.beds) document.getElementById('mBeds').value = data.beds;
                    if(data.baths) document.getElementById('mBaths').value = data.baths;
                    if(data.sqft) document.getElementById('mSqft').value = data.sqft;
                    
                    document.getElementById('manualForm').classList.add('show');
                    
                    const info = (data.price ? '$'+data.price : '') + ' ' + (data.address || '');
                    status.innerHTML = '‚úÖ Found: ' + info + '<br>Add rent and click "Add Property"';
                } else {
                    status.innerHTML = '‚ö†Ô∏è Could not extract. Try manual entry.';
                }
            } catch(err){
                console.error(err);
                // Fallback to URL parsing
                const data = parseURLData(url);
                if(data.address) document.getElementById('mAddress').value = data.address;
                document.getElementById('manualForm').classList.add('show');
                status.innerHTML = '‚ö†Ô∏è API unavailable. Using URL data. Enter details manually.';
            }
            
            btn.disabled = false;
        }
        
        // Parse property data from URL
        function parseURLData(url){
            const data = {found: false, price: '', address: '', beds: '', baths: '', sqft: ''};
            
            // Fort Worth Focused: /listing-detail/ID/ADDRESS-CITY-STATE
            const fwfMatch = url.match(/listing-detail\/\d+\/([^\/]+)/);
            if(fwfMatch){
                let addr = fwfMatch[1]
                    .replace(/-/g, ' ')
                    .trim();
                // Remove trailing state
                addr = addr.replace(/\s+TX\s*$/i, '').replace(/\s+TX$/i, '');
                data.address = addr;
                data.found = true;
            }
            
            // Zillow: /homedetails/ADDRESS-CITY-STATE-ZIP/ID_zpid/
            const zillowMatch = url.match(/\/homedetails\/([^\/]+)/);
            if(zillowMatch){
                let addr = zillowMatch[1]
                    .replace(/-/g, ' ')
                    .replace(/TX\s+\d{5}/i, '')
                    .trim();
                data.address = addr;
                data.found = true;
            }
            
            // Look for price in query string or after domain
            const priceMatch = url.match(/[?&]price=(\d+)/i);
            if(priceMatch){
                data.price = priceMatch[1];
                data.found = true;
            }
            
            return data;
        }
        
        // Ask Mango to analyze URL - saves to pending list for Mango to check
        function askMango(){
            const url = document.getElementById('propertyUrl').value;
            if(!url){
                document.getElementById('analyzeStatus').innerHTML = '‚ö†Ô∏è Paste a URL first';
                return;
            }
            // Save to pending URLs (Mango checks this)
            let pending = JSON.parse(localStorage.getItem('mangoPending') || '[]');
            if(!pending.includes(url)){
                pending.push(url);
                localStorage.setItem('mangoPending', JSON.stringify(pending));
            }
            document.getElementById('analyzeStatus').innerHTML = 'üìã URL saved! Mango will pick it up on next check.<br><small>(Or just send URL to Mango in chat for faster response)</small>';
        }
        
        // Check for pending URLs on load
        window.addEventListener('DOMContentLoaded', function(){
            const pending = JSON.parse(localStorage.getItem('mangoPending') || '[]');
            if(pending.length > 0){
                console.log('Pending URLs for Mango:', pending);
            }
        });
        
        // Manual add
        function addManualProperty(){
            const addr=document.getElementById('mAddress').value;
            const price=parseInt(document.getElementById('mPrice').value);
            const beds=parseInt(document.getElementById('mBeds').value);
            const baths=parseFloat(document.getElementById('mBaths').value)||1;
            const rent=parseInt(document.getElementById('mRent').value);
            
            if(!addr||!price||!beds||!rent){
                alert('Please fill in required fields');
                return;
            }
            
            const p=calc({address:addr,price:price,beds:beds,baths:baths,sqft:0,type:beds>=3?'SFR':'SFR',rent:rent,area:'Manual'});
            properties.push(p);
            update();
            
            // Clear form
            document.getElementById('mAddress').value='';
            document.getElementById('mPrice').value='';
            document.getElementById('mBeds').value='';
            document.getElementById('mBaths').value='';
            document.getElementById('mRent').value='';
            
            document.getElementById('analyzeStatus').textContent='Property added!';
            document.getElementById('analyzeStatus').className='analyze-status';
        }
        
        update();
    </script>
</body>
</html>
